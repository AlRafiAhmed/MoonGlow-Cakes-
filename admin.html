<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cake Delights - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        .order-card {
            transition: all 0.3s ease;
        }
        .order-card:hover {
            transform: translateY(-2px);
        }
        .mobile-menu {
            display: none;
        }
        @media (max-width: 768px) {
            .mobile-menu {
                display: block;
            }
            .desktop-menu {
                display: none;
            }
            .mobile-menu.active {
                display: block;
            }
        }
        .login-card {
            background: linear-gradient(135deg, #fff8f8 0%, #fff 100%);
            box-shadow: 0 10px 25px rgba(240, 112, 170, 0.2);
            transition: all 0.5s ease;
        }
        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(240, 112, 170, 0.3);
        }
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background-color: #fff5f8;
        }
        .input-field:focus {
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.2);
            background-color: white;
        }
        .login-btn {
            background: linear-gradient(135deg, #ec4899 0%, #d53f8c 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(236, 72, 153, 0.4);
        }
        .login-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        .login-btn:hover::after {
            animation: ripple 1s ease-out;
        }
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        .cake-icon {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .admin-profile-card {
            background: linear-gradient(135deg, #fff8f8 0%, #fff 100%);
            box-shadow: 0 10px 25px rgba(240, 112, 170, 0.2);
            transition: all 0.3s ease;
        }
        .admin-profile-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(240, 112, 170, 0.3);
        }
        .admin-avatar {
            border: 3px solid #fff;
            box-shadow: 0 5px 15px rgba(236, 72, 153, 0.3);
        }
    </style>
</head>
<body class="bg-gray-100" onload="checkLoginStatus()">
    <!-- Navigation -->
    <nav class="bg-pink-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Cake Delights</h1>
            <!-- Mobile Menu Button -->
            <button id="mobileMenuBtn" class="mobile-menu md:hidden">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            <!-- Desktop Menu -->
            <div class="desktop-menu space-x-4">
                <a href="index.html" class="hover:text-pink-200">Home</a>
                <a href="menu.html" class="hover:text-pink-200">Menu</a>
                <a href="admin.html" class="hover:text-pink-200">Admin</a>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="mobile-menu hidden md:hidden mt-4">
            <div class="flex flex-col space-y-2">
                <a href="index.html" class="hover:text-pink-200 py-2">Home</a>
                <a href="menu.html" class="hover:text-pink-200 py-2">Menu</a>
                <a href="admin.html" class="hover:text-pink-200 py-2">Admin</a>
            </div>
        </div>
    </nav>

    <!-- Admin Panel -->
    <div class="container mx-auto py-6 md:py-12 px-4">
        <!-- Login Section -->
        <div id="loginSection" class="max-w-md mx-auto login-card rounded-2xl overflow-hidden animate__animated animate__fadeIn">
            <div class="bg-gradient-to-r from-pink-500 to-pink-600 p-6 text-white text-center">
                <div class="flex justify-center mb-3">
                    <svg class="w-12 h-12 cake-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 4h3a3 3 0 006 0h3a2 2 0 012 2v9a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm2.5 7a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm2.45 4a2.5 2.5 0 10-4.9 0h4.9zM12 9a1 1 0 100 2h3a1 1 0 100-2h-3zm-1 4a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold">Admin Portal</h2>
                <p class="text-pink-100 mt-1">Manage your delicious cake business</p>
            </div>
            <div class="p-8 bg-white">
                <form id="loginForm" class="space-y-6">
                    <div class="relative">
                        <label class="block text-gray-700 mb-2 font-medium" for="username">Username</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-pink-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <select id="username" required
                                class="input-field w-full pl-10 pr-4 py-3 rounded-lg focus:outline-none text-base">
                                <option value="">Select Admin</option>
                                <option value="Al Rafi Ahmed">Al Rafi Ahmed</option>
                                <option value="Saymoon Nahar Mariam">Saymoon Nahar Mariam</option>
                            </select>
                        </div>
                    </div>
                    <div class="relative">
                        <label class="block text-gray-700 mb-2 font-medium" for="password">Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-pink-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <input type="password" id="password" required
                                class="input-field w-full pl-10 pr-4 py-3 rounded-lg focus:outline-none text-base">
                            <div id="passwordToggle" class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer">
                                <svg id="showPasswordIcon" class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                                <svg id="hidePasswordIcon" class="h-5 w-5 text-gray-400 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd" />
                                    <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <button type="submit"
                        class="login-btn w-full text-white py-3 rounded-lg text-lg font-medium">
                        Login
                    </button>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <!-- Admin Profile Card -->
            <div class="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-6 admin-profile-card animate__animated animate__fadeInDown">
                <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
                    <div class="order-2 md:order-1 flex-1">
                        <h2 class="text-4xl font-bold text-gray-800 mb-2" id="adminProfileName">Admin Name</h2>
                        <p class="text-2xl text-pink-600 font-medium mb-3" id="adminProfilePosition">Position: Administrator</p>
                        <p class="text-xl text-gray-600 mb-6">Cake Delights Bakery</p>
                        <div class="flex items-center text-gray-600 text-lg">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                            </svg>
                            <span>Last login: <span id="lastLoginTime">Today at 9:30 AM</span> (Bangladesh Time)</span>
                        </div>
                    </div>
                    <div class="order-1 md:order-2">
                        <div class="w-48 h-48 md:w-48 md:h-48 overflow-hidden admin-avatar">
                            <img id="adminProfileImage" src="https://via.placeholder.com/128x128.png?text=Admin" alt="Admin Profile" class="w-full h-full object-cover">
                        </div>
                        <div class="absolute bottom-0 right-0 bg-green-500 w-5 h-5 md:w-6 md:h-6 rounded-full border-2 border-white"></div>
                    </div>
                </div>
            </div>

            <!-- Welcome Message -->
            <div id="welcomeMessage" class="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-6 animate__animated animate__fadeInDown">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="flex items-center mb-4 md:mb-0">
                        <svg class="w-10 h-10 text-pink-500 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800" id="adminNameDisplay">Welcome!</h2>
                            <p class="text-gray-600">You've successfully logged into your admin portal</p>
                        </div>
                    </div>
                    <button id="dismissWelcome" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 md:mb-8 gap-4">
                <h2 class="text-2xl md:text-3xl font-bold" id="adminPortalTitle">Admin Dashboard</h2>
                <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 w-full md:w-auto">
                    Logout
                </button>
            </div>

            <!-- Add New Cake Form -->
            <div class="bg-white rounded-lg shadow-lg p-4 md:p-8 mb-6 md:mb-8">
                <h3 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Add New Cake Variant</h3>
                <form id="addCakeForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <div>
                        <label class="block text-gray-700 mb-1 md:mb-2" for="cakeName">Cake Name</label>
                        <input type="text" id="cakeName" required
                            class="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:border-pink-500 text-base">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-1 md:mb-2" for="cakeDescription">Description</label>
                        <textarea id="cakeDescription" required
                            class="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:border-pink-500 text-base" rows="3"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1 md:mb-2" for="smallSizePrice">Small Size Price (BDT)</label>
                        <input type="number" id="smallSizePrice" required step="1"
                            class="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:border-pink-500 text-base">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1 md:mb-2" for="mediumSizePrice">Medium Size Price (BDT)</label>
                        <input type="number" id="mediumSizePrice" required step="1"
                            class="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:border-pink-500 text-base">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1 md:mb-2" for="largeSizePrice">Large Size Price (BDT)</label>
                        <input type="number" id="largeSizePrice" required step="1"
                            class="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:border-pink-500 text-base">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-1 md:mb-2" for="cakeImage">Cake Image</label>
                        <input type="file" id="cakeImage" accept="image/*" required
                            class="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:border-pink-500 text-base">
                        <p class="text-sm text-gray-500 mt-1">Image will be displayed in Featured Cakes and Our Cake Menu</p>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-1 md:mb-2" for="cakeCategory">Category</label>
                        <select id="cakeCategory" required
                            class="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:border-pink-500 text-base">
                            <option value="">Select Category</option>
                            <option value="featured">Featured Cake</option>
                            <option value="regular">Regular Menu</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <button type="submit"
                            class="w-full bg-pink-600 text-white py-2 md:py-3 rounded-lg hover:bg-pink-700 transition duration-300 text-base md:text-lg">
                            Add Cake Variant
                        </button>
                    </div>
                </form>
            </div>

            <!-- Dashboard Tabs -->
            <div class="mb-6">
                <div class="flex flex-wrap border-b border-gray-200">
                    <button id="recentOrdersTab" class="px-4 py-2 text-pink-600 border-b-2 border-pink-600 font-medium">Recent Orders</button>
                    <button id="orderHistoryTab" class="px-4 py-2 text-gray-500 hover:text-pink-600 font-medium">Order History</button>
                    <button id="manageCakesTab" class="px-4 py-2 text-gray-500 hover:text-pink-600 font-medium">Manage Cakes</button>
                </div>
            </div>

            <!-- Orders List -->
            <div id="recentOrdersSection" class="bg-white rounded-lg shadow-lg p-4 md:p-8">
                <h3 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Recent Orders</h3>
                <div id="ordersList" class="space-y-4">
                    <!-- Orders will be dynamically added here -->
                </div>
            </div>

            <!-- Order History -->
            <div id="orderHistorySection" class="bg-white rounded-lg shadow-lg p-4 md:p-8 hidden">
                <h3 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Order History</h3>
                <div id="ordersHistoryList" class="space-y-4">
                    <!-- Order history will be dynamically added here -->
                </div>
            </div>

            <!-- Manage Cakes Section -->
            <div id="manageCakesSection" class="bg-white rounded-lg shadow-lg p-4 md:p-8 hidden">
                <h3 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">Manage Cake Variants</h3>
                <div id="cakesList" class="space-y-4">
                    <!-- Cakes will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check login status on page load
        function checkLoginStatus() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (loggedInUser) {
                const userData = JSON.parse(loggedInUser);
                showDashboard(userData, false); // Pass false to indicate this is not a fresh login
            }
        }

        // Function to show dashboard with user data
        function showDashboard(userData, isNewLogin = true) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('animate__animated', 'animate__fadeIn');
            
            // Set the admin name in the welcome message and title
            document.getElementById('adminNameDisplay').textContent = `Welcome, ${userData.username}!`;
            document.getElementById('adminPortalTitle').textContent = `${userData.username}'s Portal`;
            
            // Update admin profile card
            document.getElementById('adminProfileName').textContent = userData.username;
            document.getElementById('adminProfilePosition').textContent = `Position: ${userData.position}`;
            document.getElementById('adminProfileImage').src = userData.image;
            document.getElementById('lastLoginTime').textContent = userData.lastLogin || new Date().toLocaleString('en-US', { timeZone: 'Asia/Dhaka', hour12: true });
            
            // Only show welcome message for fresh logins, not on page reload
            if (isNewLogin) {
                // Show welcome message with animation
                const welcomeMessage = document.getElementById('welcomeMessage');
                welcomeMessage.classList.remove('hidden');
                welcomeMessage.classList.add('animate__animated', 'animate__fadeInDown');
                
                // Auto-hide welcome message after 2 seconds
                setTimeout(() => {
                    welcomeMessage.classList.add('animate__fadeOutUp');
                    setTimeout(() => {
                        welcomeMessage.classList.add('hidden');
                    }, 500);
                }, 2000);
            } else {
                // Hide welcome message on page reload
                document.getElementById('welcomeMessage').classList.add('hidden');
            }
            
            loadOrders();
            loadOrderHistory();
            loadCakes();
        }

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Password toggle visibility
        const passwordToggle = document.getElementById('passwordToggle');
        const passwordField = document.getElementById('password');
        const showPasswordIcon = document.getElementById('showPasswordIcon');
        const hidePasswordIcon = document.getElementById('hidePasswordIcon');

        passwordToggle.addEventListener('click', () => {
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                showPasswordIcon.classList.add('hidden');
                hidePasswordIcon.classList.remove('hidden');
            } else {
                passwordField.type = 'password';
                showPasswordIcon.classList.remove('hidden');
                hidePasswordIcon.classList.add('hidden');
            }
        });

        // Admin credentials (in a real application, this would be handled server-side)
        const ADMIN_CREDENTIALS = [
            {
                username: 'Al Rafi Ahmed',
                password: '1234',
                position: 'Operational Administrator',
                image: 'Al RAfi.jpg'
            },
            {
                username: 'Saymoon Nahar Mariam',
                password: '1234',
                position: 'Managing Director',
                image: 'https://randomuser.me/api/portraits/women/44.jpg'
            }
        ];

        // Welcome message dismiss button
        document.getElementById('dismissWelcome').addEventListener('click', function() {
            document.getElementById('welcomeMessage').classList.add('animate__fadeOutUp');
            setTimeout(() => {
                document.getElementById('welcomeMessage').classList.add('hidden');
            }, 500);
        });

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const validAdmin = ADMIN_CREDENTIALS.find(admin => 
                admin.username === username && admin.password === password
            );

            if (validAdmin) {
                document.getElementById('loginSection').classList.add('animate__animated', 'animate__fadeOutUp');
                
                // Save login state to localStorage
                const userData = {
                    username: validAdmin.username,
                    position: validAdmin.position,
                    image: validAdmin.image,
                    lastLogin: new Date().toLocaleString('en-US', { timeZone: 'Asia/Dhaka', hour12: true })
                };
                localStorage.setItem('loggedInUser', JSON.stringify(userData));
                
                setTimeout(() => {
                    showDashboard(userData, true); // Pass true to indicate this is a fresh login
                }, 500);
            } else {
                document.getElementById('loginSection').classList.add('animate__animated', 'animate__shakeX');
                setTimeout(() => {
                    document.getElementById('loginSection').classList.remove('animate__shakeX');
                }, 500);
                alert('Invalid credentials!');
            }
        });

        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', function() {
            // Remove the logged in user from localStorage
            localStorage.removeItem('loggedInUser');
            
            document.getElementById('adminDashboard').classList.add('animate__animated', 'animate__fadeOutDown');
            setTimeout(() => {
                document.getElementById('adminDashboard').classList.add('hidden');
                document.getElementById('loginSection').classList.remove('hidden', 'animate__fadeOutUp');
                document.getElementById('loginSection').classList.add('animate__fadeIn');
                document.getElementById('loginForm').reset();
                document.getElementById('adminDashboard').classList.remove('animate__fadeOutDown');
            }, 500);
        });

        // Tab switching
        document.getElementById('recentOrdersTab').addEventListener('click', function() {
            document.getElementById('recentOrdersSection').classList.remove('hidden');
            document.getElementById('orderHistorySection').classList.add('hidden');
            document.getElementById('manageCakesSection').classList.add('hidden');
            this.classList.add('text-pink-600', 'border-b-2', 'border-pink-600');
            this.classList.remove('text-gray-500');
            document.getElementById('orderHistoryTab').classList.remove('text-pink-600', 'border-b-2', 'border-pink-600');
            document.getElementById('orderHistoryTab').classList.add('text-gray-500');
            document.getElementById('manageCakesTab').classList.remove('text-pink-600', 'border-b-2', 'border-pink-600');
            document.getElementById('manageCakesTab').classList.add('text-gray-500');
        });

        document.getElementById('orderHistoryTab').addEventListener('click', function() {
            document.getElementById('recentOrdersSection').classList.add('hidden');
            document.getElementById('orderHistorySection').classList.remove('hidden');
            document.getElementById('manageCakesSection').classList.add('hidden');
            this.classList.add('text-pink-600', 'border-b-2', 'border-pink-600');
            this.classList.remove('text-gray-500');
            document.getElementById('recentOrdersTab').classList.remove('text-pink-600', 'border-b-2', 'border-pink-600');
            document.getElementById('recentOrdersTab').classList.add('text-gray-500');
            document.getElementById('manageCakesTab').classList.remove('text-pink-600', 'border-b-2', 'border-pink-600');
            document.getElementById('manageCakesTab').classList.add('text-gray-500');
            loadOrderHistory();
        });

        document.getElementById('manageCakesTab').addEventListener('click', function() {
            document.getElementById('recentOrdersSection').classList.add('hidden');
            document.getElementById('orderHistorySection').classList.add('hidden');
            document.getElementById('manageCakesSection').classList.remove('hidden');
            this.classList.add('text-pink-600', 'border-b-2', 'border-pink-600');
            this.classList.remove('text-gray-500');
            document.getElementById('recentOrdersTab').classList.remove('text-pink-600', 'border-b-2', 'border-pink-600');
            document.getElementById('recentOrdersTab').classList.add('text-gray-500');
            document.getElementById('orderHistoryTab').classList.remove('text-pink-600', 'border-b-2', 'border-pink-600');
            document.getElementById('orderHistoryTab').classList.add('text-gray-500');
            loadCakes();
        });

        // Add new cake form handler
        document.getElementById('addCakeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const cakeImageFile = document.getElementById('cakeImage').files[0];
            if (!cakeImageFile) {
                alert('Please select an image for the cake');
                return;
            }
            
            // Convert image to base64 for storage
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageBase64 = event.target.result;
                
                const newCake = {
                    id: Date.now(), // Generate a unique ID
                    name: document.getElementById('cakeName').value,
                    description: document.getElementById('cakeDescription').value,
                    prices: {
                        small: document.getElementById('smallSizePrice').value,
                        medium: document.getElementById('mediumSizePrice').value,
                        large: document.getElementById('largeSizePrice').value
                    },
                    image: imageBase64,
                    category: document.getElementById('cakeCategory').value,
                    dateAdded: new Date().toISOString()
                };

                // Store in localStorage (in a real application, this would be sent to a server)
                const cakes = JSON.parse(localStorage.getItem('cakeVariants') || '[]');
                cakes.push(newCake);
                localStorage.setItem('cakeVariants', JSON.stringify(cakes));

                alert('New cake variant added successfully!');
                loadCakes(); // Refresh the cakes list
                this.reset();
            };
            reader.readAsDataURL(cakeImageFile);
        });

        // Load and display orders
        function loadOrders() {
            const ordersList = document.getElementById('ordersList');
            const orders = JSON.parse(localStorage.getItem('cakeOrders') || '[]');
            const pendingOrders = orders.filter(order => order.status === 'pending');

            ordersList.innerHTML = pendingOrders.length === 0 ? 
                '<p class="text-gray-500 text-center py-4">No pending orders</p>' : 
                pendingOrders.map(order => `
                <div class="order-card bg-gray-50 p-4 md:p-6 rounded-lg border">
                    <div class="flex flex-col md:flex-row justify-between items-start gap-4">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold">${order.name}</h4>
                            <p class="text-gray-600">Phone: ${order.phone}</p>
                            <p class="text-gray-600">Address: ${order.address}</p>
                            <p class="text-gray-600">Cake: ${order.flavor} - ${order.size}</p>
                            ${order.message ? `<p class="text-gray-600">Message: ${order.message}</p>` : ''}
                            <p class="text-sm text-gray-500">Ordered on: ${new Date(order.date).toLocaleString()}</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                            <button onclick="updateOrderStatus(${order.id}, 'accepted')"
                                class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full sm:w-auto">
                                Accept
                            </button>
                            <button onclick="updateOrderStatus(${order.id}, 'cancelled')"
                                class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 w-full sm:w-auto">
                                Cancel
                            </button>
                        </div>
                    </div>
                    <div class="mt-2">
                        <span class="px-3 py-1 rounded-full text-sm ${
                            order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                            order.status === 'accepted' ? 'bg-green-100 text-green-800' :
                            'bg-red-100 text-red-800'
                        }">
                            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // Load and display order history
        function loadOrderHistory() {
            const ordersHistoryList = document.getElementById('ordersHistoryList');
            const orders = JSON.parse(localStorage.getItem('cakeOrders') || '[]');
            const historyOrders = orders.filter(order => order.status === 'accepted' || order.status === 'cancelled');
            
            // Sort history orders by statusUpdateTime in descending order (most recent first)
            historyOrders.sort((a, b) => {
                const timeA = new Date(a.statusUpdateTime || a.date).getTime();
                const timeB = new Date(b.statusUpdateTime || b.date).getTime();
                return timeB - timeA;
            });

            ordersHistoryList.innerHTML = historyOrders.length === 0 ? 
                '<p class="text-gray-500 text-center py-4">No order history</p>' : 
                historyOrders.map(order => `
                <div class="order-card bg-gray-50 p-4 md:p-6 rounded-lg border">
                    <div class="flex flex-col md:flex-row justify-between items-start gap-4">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold">${order.name}</h4>
                            <p class="text-gray-600">Phone: ${order.phone}</p>
                            <p class="text-gray-600">Address: ${order.address}</p>
                            <p class="text-gray-600">Cake: ${order.flavor} - ${order.size}</p>
                            ${order.message ? `<p class="text-gray-600">Message: ${order.message}</p>` : ''}
                            <p class="text-sm text-gray-500">Ordered on: ${new Date(order.date).toLocaleString()}</p>
                            ${order.statusUpdateTime ? 
                                `<p class="text-sm text-gray-500">${order.status === 'accepted' ? 'Accepted' : 'Cancelled'} on: ${new Date(order.statusUpdateTime).toLocaleString()}</p>` : ''}
                        </div>
                    </div>
                    <div class="mt-2">
                        <span class="px-3 py-1 rounded-full text-sm ${
                            order.status === 'accepted' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // Load and display cakes for management
        function loadCakes() {
            const cakesList = document.getElementById('cakesList');
            const cakes = JSON.parse(localStorage.getItem('cakeVariants') || '[]');
            
            // Sort cakes by date added (most recent first)
            cakes.sort((a, b) => {
                const dateA = new Date(a.dateAdded || 0).getTime();
                const dateB = new Date(b.dateAdded || 0).getTime();
                return dateB - dateA;
            });

            cakesList.innerHTML = cakes.length === 0 ? 
                '<p class="text-gray-500 text-center py-4">No cakes added yet</p>' : 
                cakes.map(cake => `
                <div class="order-card bg-gray-50 p-4 md:p-6 rounded-lg border">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="w-full md:w-1/4">
                            <img src="${cake.image}" alt="${cake.name}" class="w-full h-48 object-cover rounded-lg">
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold">${cake.name}</h4>
                            <p class="text-gray-600">${cake.description}</p>
                            <div class="mt-2 grid grid-cols-3 gap-2">
                                <p class="text-gray-600">Small: ${cake.prices.small} BDT</p>
                                <p class="text-gray-600">Medium: ${cake.prices.medium} BDT</p>
                                <p class="text-gray-600">Large: ${cake.prices.large} BDT</p>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">Category: ${
                                cake.category === 'featured' ? 'Featured Cake' : 
                                cake.category === 'regular' ? 'Regular Menu' : 
                                'Featured & Regular Menu'
                            }</p>
                            <p class="text-sm text-gray-500">Added on: ${new Date(cake.dateAdded).toLocaleString()}</p>
                            <div class="mt-4 flex flex-wrap gap-2">
                                <button onclick="editCake(${cake.id})"
                                    class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                                    Edit
                                </button>
                                <button onclick="deleteCake(${cake.id})"
                                    class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update order status
        function updateOrderStatus(orderId, newStatus) {
            const orders = JSON.parse(localStorage.getItem('cakeOrders') || '[]');
            const orderIndex = orders.findIndex(order => order.id === orderId);
            
            if (orderIndex !== -1) {
                orders[orderIndex].status = newStatus;
                orders[orderIndex].statusUpdateTime = new Date().toISOString();
                localStorage.setItem('cakeOrders', JSON.stringify(orders));
                loadOrders();
                loadOrderHistory();
            }
        }

        // Delete cake function
        function deleteCake(cakeId) {
            if (confirm('Are you sure you want to delete this cake variant?')) {
                const cakes = JSON.parse(localStorage.getItem('cakeVariants') || '[]');
                const updatedCakes = cakes.filter(cake => cake.id !== cakeId);
                localStorage.setItem('cakeVariants', JSON.stringify(updatedCakes));
                
                // Also remove any orders associated with this cake
                const orders = JSON.parse(localStorage.getItem('cakeOrders') || '[]');
                const updatedOrders = orders.filter(order => {
                    const cakes = JSON.parse(localStorage.getItem('cakeVariants') || '[]');
                    return cakes.some(cake => cake.name === order.flavor);
                });
                localStorage.setItem('cakeOrders', JSON.stringify(updatedOrders));
                
                alert('Cake variant deleted successfully!');
                loadCakes();
            }
        }

        // Edit cake function
        function editCake(cakeId) {
            const cakes = JSON.parse(localStorage.getItem('cakeVariants') || '[]');
            const cake = cakes.find(c => c.id === cakeId);
            
            if (cake) {
                // Populate the form with cake data
                document.getElementById('cakeName').value = cake.name;
                document.getElementById('cakeDescription').value = cake.description;
                document.getElementById('smallSizePrice').value = cake.prices.small;
                document.getElementById('mediumSizePrice').value = cake.prices.medium;
                document.getElementById('largeSizePrice').value = cake.prices.large;
                document.getElementById('cakeCategory').value = cake.category;
                
                // Change the form submission to update instead of add
                const form = document.getElementById('addCakeForm');
                const originalSubmitHandler = form.onsubmit;
                
                // Scroll to the form
                form.scrollIntoView({ behavior: 'smooth' });
                
                // Change button text
                form.querySelector('button[type="submit"]').textContent = 'Update Cake Variant';
                
                // Override the submit handler temporarily
                form.onsubmit = function(e) {
                    e.preventDefault();
                    
                    // Get the updated data
                    const updatedCake = {
                        ...cake, // Keep all original data including id
                        name: document.getElementById('cakeName').value,
                        description: document.getElementById('cakeDescription').value,
                        prices: {
                            small: document.getElementById('smallSizePrice').value,
                            medium: document.getElementById('mediumSizePrice').value,
                            large: document.getElementById('largeSizePrice').value
                        },
                        category: document.getElementById('cakeCategory').value,
                        dateAdded: cake.dateAdded // Keep the original date
                    };
                    
                    // Update image only if a new one is selected
                    const cakeImageFile = document.getElementById('cakeImage').files[0];
                    if (cakeImageFile) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            updatedCake.image = event.target.result;
                            updateCakeInStorage(updatedCake);
                        };
                        reader.readAsDataURL(cakeImageFile);
                    } else {
                        // Keep the original image if no new one is selected
                        updateCakeInStorage(updatedCake);
                    }
                    
                    // Reset form and restore original handler
                    form.reset();
                    form.querySelector('button[type="submit"]').textContent = 'Add Cake Variant';
                    form.onsubmit = originalSubmitHandler;
                };
            }
        }
        
        // Helper function to update cake in storage
        function updateCakeInStorage(updatedCake) {
            const cakes = JSON.parse(localStorage.getItem('cakeVariants') || '[]');
            const index = cakes.findIndex(c => c.id === updatedCake.id);
            
            if (index !== -1) {
                // Update the cake in the array
                cakes[index] = updatedCake;
                localStorage.setItem('cakeVariants', JSON.stringify(cakes));

                // Update any orders that reference this cake
                const orders = JSON.parse(localStorage.getItem('cakeOrders') || '[]');
                const updatedOrders = orders.map(order => {
                    if (order.flavor === updatedCake.name) {
                        return {
                            ...order,
                            flavor: updatedCake.name
                        };
                    }
                    return order;
                });
                localStorage.setItem('cakeOrders', JSON.stringify(updatedOrders));

                alert('Cake variant updated successfully!');
                loadCakes();
            }
        }
    </script>
</body>
</html> 